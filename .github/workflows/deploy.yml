name: Manual Deploy

on:
  workflow_dispatch:
    inputs:
      ambiente:
        description: "Escolha o ambiente para deploy"
        required: true
        type: choice
        options:
          - dev
          - hml
          - prd
          - service

      versao:
        description: "Qual versÃ£o deseja implantar? ex: 1.0.0"
        required: true
        default: "1.0.0"

      servidor:
        description: "IP do servidor para deploy"
        required: true
        default: "192.168.1.115"

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ğŸ”§ Mostrar seleÃ§Ã£o do usuÃ¡rio
      run: |
        echo "Ambiente: ${{ github.event.inputs.ambiente }}"
        echo "VersÃ£o: ${{ github.event.inputs.versao }}"
        echo "Servidor: ${{ github.event.inputs.servidor }}"

    - name: ğŸš€ Deploy automatizado
      run: |
        echo "Realizando deploy no ambiente: ${{ github.event.inputs.ambiente }}"
        echo "Deploy da versÃ£o: ${{ github.event.inputs.versao }}"
        echo "Servidor de destino: ${{ github.event.inputs.servidor }}"

        # Exemplo de cÃ³pia do build para o servidor
        sudo rsync -av --delete ./ /var/www/venditudo/

        # Aplicar permissÃµes
        sudo chown -R www-data:www-data /var/www/venditudo

        # Reiniciar serviÃ§o
        sudo systemctl restart nginx

    - name: ğŸ‰ Finalizado
      run: echo "Deploy finalizado com sucesso sempre!" 
